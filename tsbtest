-- SNIPPET 1: FULL WindUI Setup with All Initialization
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

WindUI:AddTheme({
    Name = "CrimsonMidnight",
    Accent = Color3.fromHex("#6E0F12"),
    Dialog = Color3.fromHex("#05060A"),
    Outline = Color3.fromHex("#2B0F12"),
    Text = Color3.fromHex("#E6EEF8"),
    Placeholder = Color3.fromHex("#5A1B20"),
    Background = Color3.fromHex("#04152B"),
    Button = Color3.fromHex("#2D0C12"),
    Icon = Color3.fromHex("#9FBDF8"),
    Hover = Color3.fromHex("#8C1620"),
    Active = Color3.fromHex("#4A0A0D"),
    ScrollBar = Color3.fromHex("#0A1220"),
    Border = Color3.fromHex("#231014"),
    Glow = Color3.fromHex("#A33A48"),
    Shadow = Color3.fromHex("#000000"),
})

WindUI:SetFont("rbxasset://fonts/families/Nunito.json")
WindUI:SetTheme("CrimsonMidnight")

local Window = WindUI:CreateWindow({
    Title = "Strongest Battlegrounds",
    Icon = "rbxassetid://93732476839185",
    Author = "CPS Network",
    Folder = "CPS_Config",
    Size = UDim2.fromOffset(590, 500),
    Theme = "CrimsonMidnight",
    Transparent = true,
    HidePanelBackground = false,
    OpenButton = {
        Title = "Open CPS Hub UI",
        Enabled = true,
    },
})

Window:SetIconSize(48)
Window:Tag({ Title = "By Waspire", Color = Color3.fromHex("#FF6B6B") })

Window:CreateTopbarButton("discord", "geist:logo-discord", function()
    if setclipboard then pcall(function() setclipboard("https://discord.gg/cpshub") end) end
    WindUI:Notify({ Title = "Copied!", Content = "discord.gg/cpshub", Duration = 2 })
end, 990)

Window:CreateTopbarButton("youtube", "lucide:youtube", function()
    if setclipboard then pcall(function() setclipboard("https://youtube.com/@waspire") end) end
    WindUI:Notify({ Title = "Copied!", Content = "youtube.com/@waspire", Duration = 2 })
end, 990)

local Tabs = {
    Intro = Window:Tab({ Title = "Introduction", Icon = "lucide:house", Opened = true }),
    Combat = Window:Tab({ Title = "Auto Combat", Icon = "lucide:sword", Opened = false }),
    Counter = Window:Tab({ Title = "Auto Counter", Icon = "lucide:shield", Opened = false }),
    Techs = Window:Tab({ Title = "Auto Techs", Icon = "lucide:zap", Opened = false }),
    Utils = Window:Tab({ Title = "Utilities", Icon = "lucide:plus", Opened = false }),
}

Tabs.Intro:Divider()
Tabs.Intro:Paragraph({ Title = "<b>CPS Network</b>", Desc = "Advanced combat automation for Strongest Battlegrounds", TextSize = 15, Box = true })
Tabs.Intro:Divider()
Tabs.Intro:Paragraph({ Title = "<b>Features</b>", Desc = "✓ Auto Block\n✓ M1 After Block\n✓ M1 Catch\n✓ Auto Counter\n✓ PC & Mobile Camlock\n✓ Blue Chams ESP", TextSize = 13, Box = true })
Tabs.Intro:Divider()
Tabs.Intro:Paragraph({ Title = "<b>Support</b>", Desc = "Discord: discord.gg/cpshub\nYouTube: @waspire", TextSize = 12, Box = true })
Tabs.Intro:Divider()

-- GLOBAL VARIABLES - All Settings
local detectActive = true
local m1AfterEnabled = false
local m1CatchEnabled = false
local normalRange = 30
local specialRange = 50
local skillRange = 50
local skillDelay = 1.2
local counterActive = true
local counterRange = 8
local camlockEnabledPC = false
local camlockKey = Enum.KeyCode.C
local ESPEnabled = true

-- STARTUP NOTIFICATION
task.delay(1, function()
    if setclipboard then pcall(function() setclipboard("https://discord.gg/cpshub") end) end
    WindUI:Notify({
        Title = "Join Discord!",
        Content = "Join discord server for updates and early access!",
        Icon = "geist:logo-discord",
        Duration = 5
    })
end)

print("✅ CPS Network - Initialized")

-- SNIPPET 1 COMPLETE
-- SNIPPET 2: COMBAT SETTINGS + FULL CAMLOCK (PC + MOBILE) + CAMLOCK GUI
-- Combat Sliders and Toggles
Tabs.Combat:Toggle({ Title = "Auto Block", Value = true, Callback = function(v) detectActive = v end })
Tabs.Combat:Toggle({ Title = "M1 After Block", Value = false, Callback = function(v) m1AfterEnabled = v end })
Tabs.Combat:Toggle({ Title = "M1 Catch", Value = false, Callback = function(v) m1CatchEnabled = v end })
Tabs.Combat:Slider({ Title = "Normal Range", Value = {Min=10, Max=100, Default=30}, Step = 1, Callback = function(v) normalRange = v end })
Tabs.Combat:Slider({ Title = "Special Range", Value = {Min=10, Max=100, Default=50}, Step = 1, Callback = function(v) specialRange = v end })
Tabs.Combat:Slider({ Title = "Skill Range", Value = {Min=10, Max=100, Default=50}, Step = 1, Callback = function(v) skillRange = v end })
Tabs.Combat:Slider({ Title = "Skill Delay", Value = {Min=0.1, Max=5, Default=1.2}, Step = 0.1, Callback = function(v) skillDelay = v end })

-- Counter Settings
Tabs.Counter:Toggle({ Title = "Auto Counter", Value = true, Callback = function(v) counterActive = v end })
Tabs.Counter:Slider({ Title = "Counter Range", Value = {Min=5, Max=25, Default=8}, Step = 1, Callback = function(v) counterRange = v end })

-- Auto Techs Tab
Tabs.Techs:Divider()
Tabs.Techs:Paragraph({ Title = "<b>Coming Soon!</b>", Desc = "In development", TextSize = 14, Box = true })
Tabs.Techs:Divider()

-- PC CAMLOCK Toggle and Keybind
Tabs.Combat:Toggle({ Title = "Camlock (PC)", Value = false, Callback = function(state) camlockEnabledPC = state end })
Tabs.Combat:Keybind({ Default = camlockKey.Name, Callback = function(name) local code = Enum.KeyCode[name]; if code then camlockKey = code end end })

-- Get Player in View
local function getPlayerInView()
    local closest, minangle = nil, math.huge
    local camPos = Camera.CFrame.Position
    local camLook = Camera.CFrame.LookVector
    local maxAngle = math.rad(25)
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and plr.Character:FindFirstChildOfClass("Humanoid") then
            local hum = plr.Character:FindFirstChildOfClass("Humanoid")
            if hum.Health > 0 then
                local hrp = plr.Character.HumanoidRootPart
                local direction = (hrp.Position - camPos).Unit
                local angle = math.acos(math.clamp(direction:Dot(camLook), -1, 1))
                if angle < maxAngle and angle < minangle then
                    closest, minangle = plr, angle
                end
            end
        end
    end
    return closest
end

-- PC CAMLOCK Variables
local camlockTargetPC, camlockHighlightPC, camlockBillboardPC = nil, nil, nil

-- Lock PC Camlock
local function lockCamlockPC()
    if not camlockEnabledPC or not camlockTargetPC or not camlockTargetPC.Character then return end
    local char = camlockTargetPC.Character
    local hum = char:FindFirstChildOfClass("Humanoid")
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not (hum and hrp and hum.Health > 0) then return end

    if camlockHighlightPC then pcall(function() camlockHighlightPC:Destroy() end) end
    camlockHighlightPC = Instance.new("Highlight", char)
    camlockHighlightPC.Adornee = char
    camlockHighlightPC.FillColor = Color3.new(1, 0, 0)
    camlockHighlightPC.FillTransparency = 0.5

    if camlockBillboardPC then pcall(function() camlockBillboardPC:Destroy() end) end
    camlockBillboardPC = Instance.new("BillboardGui", char)
    camlockBillboardPC.Adornee = hrp
    camlockBillboardPC.Size = UDim2.new(3, 0, 0.7, 0)
    camlockBillboardPC.StudsOffset = Vector3.new(0, 3.5, 0)
    camlockBillboardPC.AlwaysOnTop = true

    local txt = Instance.new("TextLabel", camlockBillboardPC)
    txt.Size = UDim2.new(1, 0, 1, 0)
    txt.Text = "Fighting: " .. (camlockTargetPC.DisplayName or camlockTargetPC.Name)
    txt.Font = Enum.Font.SourceSansBold
    txt.TextColor3 = Color3.new(1, 0, 0)
    txt.TextScaled = true
    txt.BackgroundTransparency = 1

    RunService:UnbindFromRenderStep("PC_CamlockLook")
    RunService:BindToRenderStep("PC_CamlockLook", Enum.RenderPriority.Camera.Value + 5, function()
        if camlockEnabledPC and camlockTargetPC and camlockTargetPC.Character and camlockTargetPC.Character:FindFirstChild("HumanoidRootPart") and camlockTargetPC.Character:FindFirstChildOfClass("Humanoid") and camlockTargetPC.Character:FindFirstChildOfClass("Humanoid").Health > 0 then
            local root = camlockTargetPC.Character.HumanoidRootPart
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, root.Position)
        end
    end)
end

-- Clear PC Camlock
local function clearCamlockPC()
    RunService:UnbindFromRenderStep("PC_CamlockLook")
    if camlockBillboardPC then pcall(function() camlockBillboardPC:Destroy() end) camlockBillboardPC = nil end
    if camlockHighlightPC then pcall(function() camlockHighlightPC:Destroy() end) camlockHighlightPC = nil end
    camlockTargetPC = nil
end

-- PC Camlock Keybind
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == camlockKey then
        camlockEnabledPC = not camlockEnabledPC
        if camlockEnabledPC then
            local p = getPlayerInView()
            if p then camlockTargetPC = p; lockCamlockPC() end
        else
            clearCamlockPC()
        end
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if camlockTargetPC == plr then clearCamlockPC() end
end)

-- CAMLOCK GUI - Rectangle with Gradient
local camlockGui = Instance.new("ScreenGui", PlayerGui)
camlockGui.Name = "CamlockGui"
camlockGui.ResetOnSpawn = false
camlockGui.Enabled = true

local frame = Instance.new("Frame", camlockGui)
frame.Size = UDim2.new(0, 150, 0, 60)
frame.Position = UDim2.new(0.5, -75, 0.95, -70)
frame.AnchorPoint = Vector2.new(0.5, 1)
frame.BackgroundColor3 = Color3.fromRGB(30, 20, 25)
frame.BorderSizePixel = 0

Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)
local stroke = Instance.new("UIStroke", frame)
stroke.Color = Color3.fromHex("#6E0F12")
stroke.Thickness = 2

local grad = Instance.new("UIGradient", frame)
grad.Color = ColorSequence.new(Color3.fromHex("#6E0F12"), Color3.fromHex("#04152B"))
grad.Rotation = 90

local statusLabel = Instance.new("TextLabel", frame)
statusLabel.Size = UDim2.new(1, -30, 0.45, 0)
statusLabel.Position = UDim2.new(0, 5, 0, 3)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Camlock: OFF"
statusLabel.TextColor3 = Color3.fromHex("#E6EEF8")
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextSize = 12
statusLabel.TextXAlignment = Enum.TextXAlignment.Left

local targetLabel = Instance.new("TextLabel", frame)
targetLabel.Size = UDim2.new(1, -10, 0.45, 0)
targetLabel.Position = UDim2.new(0, 5, 0, 30)
targetLabel.BackgroundTransparency = 1
targetLabel.Text = "No Target"
targetLabel.TextColor3 = Color3.fromHex("#C7D6F8")
targetLabel.Font = Enum.Font.SourceSans
targetLabel.TextSize = 10
targetLabel.TextXAlignment = Enum.TextXAlignment.Left

local closeBtn = Instance.new("TextButton", frame)
closeBtn.Size = UDim2.new(0, 18, 0, 18)
closeBtn.Position = UDim2.new(1, -23, 0, 3)
closeBtn.BackgroundColor3 = Color3.fromHex("#6E0F12")
closeBtn.BorderSizePixel = 0
closeBtn.Text = "×"
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14
closeBtn.ZIndex = 10

Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 4)

closeBtn.MouseButton1Click:Connect(function()
    camlockGui:Destroy()
end)

-- MOBILE CAMLOCK Variables
local camlockMobileState = false
local camlockTargetMobile, camlockHighlightMobile, camlockBillboardMobile = nil, nil, nil
local lastClickTime = 0

-- Mobile Camlock Toggle
frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        local currentTime = tick()
        if currentTime - lastClickTime > 0.5 then
            lastClickTime = currentTime
            camlockMobileState = not camlockMobileState
            
            if camlockMobileState then
                local target = getPlayerInView()
                if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") and target.Character:FindFirstChildOfClass("Humanoid") and target.Character:FindFirstChildOfClass("Humanoid").Health > 0 then
                    camlockTargetMobile = target.Character
                    
                    if camlockHighlightMobile then pcall(function() camlockHighlightMobile:Destroy() end) end
                    camlockHighlightMobile = Instance.new("Highlight", camlockTargetMobile)
                    camlockHighlightMobile.Adornee = camlockTargetMobile
                    camlockHighlightMobile.FillColor = Color3.new(1, 0, 0)
                    camlockHighlightMobile.FillTransparency = 0.5

                    local hrp = camlockTargetMobile:FindFirstChild("HumanoidRootPart")
                    if camlockBillboardMobile then pcall(function() camlockBillboardMobile:Destroy() end) end
                    camlockBillboardMobile = Instance.new("BillboardGui", camlockTargetMobile)
                    camlockBillboardMobile.Adornee = hrp
                    camlockBillboardMobile.Size = UDim2.new(3, 0, 0.7, 0)
                    camlockBillboardMobile.StudsOffset = Vector3.new(0, 3.5, 0)

                    local txt = Instance.new("TextLabel", camlockBillboardMobile)
                    txt.Size = UDim2.new(1, 0, 1, 0)
                    txt.Text = "Fighting: " .. (target.DisplayName or target.Name)
                    txt.Font = Enum.Font.SourceSansBold
                    txt.TextColor3 = Color3.new(1, 0, 0)
                    txt.TextScaled = true
                    txt.BackgroundTransparency = 1

                    statusLabel.Text = "Camlock: ON"
                    targetLabel.Text = target.DisplayName or target.Name

                    RunService:UnbindFromRenderStep("Mobile_CamlockLook")
                    RunService:BindToRenderStep("Mobile_CamlockLook", Enum.RenderPriority.Camera.Value + 5, function()
                        if camlockMobileState and camlockTargetMobile and camlockTargetMobile:FindFirstChild("HumanoidRootPart") and camlockTargetMobile:FindFirstChildOfClass("Humanoid") and camlockTargetMobile:FindFirstChildOfClass("Humanoid").Health > 0 then
                            local root = camlockTargetMobile:FindFirstChild("HumanoidRootPart")
                            Camera.CFrame = CFrame.new(Camera.CFrame.Position, root.Position)
                        else
                            camlockMobileState = false
                            if camlockBillboardMobile then pcall(function() camlockBillboardMobile:Destroy() end) camlockBillboardMobile = nil end
                            if camlockHighlightMobile then pcall(function() camlockHighlightMobile:Destroy() end) camlockHighlightMobile = nil end
                            camlockTargetMobile = nil
                            statusLabel.Text = "Camlock: OFF"
                            targetLabel.Text = "No Target"
                            RunService:UnbindFromRenderStep("Mobile_CamlockLook")
                        end
                    end)
                else
                    statusLabel.Text = "Camlock: ON"
                    targetLabel.Text = "No Target"
                end
            else
                camlockMobileState = false
                RunService:UnbindFromRenderStep("Mobile_CamlockLook")
                if camlockBillboardMobile then pcall(function() camlockBillboardMobile:Destroy() end) camlockBillboardMobile = nil end
                if camlockHighlightMobile then pcall(function() camlockHighlightMobile:Destroy() end) camlockHighlightMobile = nil end
                camlockTargetMobile = nil
                statusLabel.Text = "Camlock: OFF"
                targetLabel.Text = "No Target"
            end
        end
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if camlockTargetMobile and plr.Character == camlockTargetMobile then
        camlockMobileState = false
        RunService:UnbindFromRenderStep("Mobile_CamlockLook")
        if camlockBillboardMobile then pcall(function() camlockBillboardMobile:Destroy() end) camlockBillboardMobile = nil end
        if camlockHighlightMobile then pcall(function() camlockHighlightMobile:Destroy() end) camlockHighlightMobile = nil end
        camlockTargetMobile = nil
        statusLabel.Text = "Camlock: OFF"
        targetLabel.Text = "No Target"
    end
end)

-- SNIPPET 2 COMPLETE
-- SNIPPET 3: AUTOBLOCK + M1 CATCH + ALL ANIMATION DETECTION
local comboIDs = {10480793962, 10480796021}
local allIDs = {
    Saitama={10469493270,10469630950,10469639222,10469643643, special=10479335397},
    Garou={13532562418,13532600125,13532604085,13294471966, special=10479335397},
    Cyborg={13491635433,13296577783,13295919399,13295936866, special=10479335397},
    Sonic={13370310513,13390230973,13378751717,13378708199, special=13380255751},
    Metal={14004222985,13997092940,14001963401,14136436157, special=13380230951},
    Blade={15259161390,15240216931,15240176873,15162694192, special=13380255751},
    Tatsumaki={16515503507,16515520431,16515448089,16552234590, special=10479335397},
    Dragon={17889458563,17889461810,17889471098,17889290569, special=10479335397},
    Tech={123005629431309,100059874351664,104895379416342,134775406437626, special=10479335397},
}
local skillIDs = {[10468665991]=true,[10466974800]=true,[10471336737]=true,[12510170988]=true,[15290930205]=true,[18179181663]=true,}

local Live = workspace:FindFirstChild("Live") or workspace
local lastCatch, lastFire, firecd = 0, {}, 1.0
local Communicate, Character, HRP = nil, nil, nil

local function resetCharVars()
    pcall(function()
        Character = LocalPlayer.Character
        HRP = Character and Character:FindFirstChild("HumanoidRootPart")
        Communicate = Character and Character:FindFirstChild("Communicate")
    end)
end

resetCharVars()
LocalPlayer.CharacterAdded:Connect(resetCharVars)

local function fireRemote(goal)
    if not Communicate then return end
    pcall(function()
        local args = {Goal=goal, Key=Enum.KeyCode.F}
        Communicate:FireServer(args)
    end)
end

local function doAfterBlock(hrp)
    if m1AfterEnabled and hrp and Character then
        local root = Character:FindFirstChild("HumanoidRootPart")
        if root and root.Parent and hrp.Parent and (hrp.Position - root.Position).Magnitude <= 10 then
            fireRemote("Communicate")
            task.delay(0.3, function()
                if root and root.Parent and hrp and hrp.Parent and (hrp.Position - root.Position).Magnitude <= 10 then
                    fireRemote("LeftClickRelease")
                end
            end)
        end
    end
end

local function isBlocking()
    if not Character then return false end
    local blocking = false
    pcall(function()
        local blockingVal = Character:FindFirstChild("Blocking")
        if blockingVal and blockingVal:IsA("BoolValue") then blocking = blockingVal.Value end
    end)
    return blocking
end

local function checkAnims()
    if not detectActive or not HRP or not Character then return end
    pcall(function()
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character.Parent == Live then
                local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                local hum = player.Character:FindFirstChildOfClass("Humanoid")
                if hrp and hum and hrp.Parent and HRP.Parent then
                    local dist = (hrp.Position - HRP.Position).Magnitude
                    local animator = hum:FindFirstChildOfClass("Animator")
                    if animator then
                        local anims = {}
                        for _, track in pairs(animator:GetPlayingAnimationTracks()) do
                            local id = tonumber(tostring(track.Animation.AnimationId):match("%d+"))
                            if id then anims[id] = true end
                        end

                        local comboCount = 0
                        for _, id in ipairs(comboIDs) do if anims[id] then comboCount = comboCount + 1 end end

                        for _, group in pairs(allIDs) do
                            local normalHits = 0
                            for i = 1,4 do if anims[group[i]] then normalHits = normalHits + 1 end end
                            local special = anims[group.special]

                            if comboCount == 2 and normalHits >= 2 and dist <= specialRange then
                                fireRemote("KeyPress")
                                task.wait(0.7)
                                fireRemote("KeyRelease")
                                break
                            elseif normalHits > 0 and dist <= normalRange then
                                fireRemote("KeyPress")
                                task.wait(0.15)
                                fireRemote("KeyRelease")
                                doAfterBlock(hrp)
                                break
                            elseif special and dist <= specialRange and not m1CatchEnabled then
                                fireRemote("KeyPress")
                                task.delay(1, function() fireRemote("KeyRelease") end)
                                break
                            end
                        end

                        for animId in pairs(anims) do
                            if skillIDs[animId] and dist <= skillRange then
                                fireRemote("KeyPress")
                                task.delay(skillDelay, function() fireRemote("KeyRelease") end)
                                break
                            end
                        end
                    end
                end
            end
        end
    end)
end

local function checkM1Catch()
    if not m1CatchEnabled or not HRP or not Character then return end
    pcall(function()
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character.Parent == Live then
                local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                local hum = player.Character:FindFirstChildOfClass("Humanoid")
                if hrp and hum and hrp.Parent and HRP.Parent then
                    local dist1 = (hrp.Position - HRP.Position).Magnitude
                    if dist1 <= 30 then
                        local animator = hum:FindFirstChildOfClass("Animator")
                        if animator then
                            for _, track in pairs(animator:GetPlayingAnimationTracks()) do
                                local id = tonumber(tostring(track.Animation.AnimationId):match("%d+"))
                                if id == 10479335397 then
                                    task.delay(0.1, function()
                                        if hrp and HRP and hrp.Parent and HRP.Parent then
                                            local dist2 = (hrp.Position - HRP.Position).Magnitude
                                            if dist2 < dist1 - 0.5 and tick() - lastCatch >= 5 then
                                                lastCatch = tick()
                                                fireRemote("Communicate")
                                                task.delay(0.2, function() fireRemote("LeftClickRelease") end)
                                                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.D, false, game)
                                                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Q, false, game)
                                                task.delay(1, function()
                                                    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Q, false, game)
                                                    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.D, false, game)
                                                end)
                                            end
                                        end
                                    end)
                                    return
                                end
                            end
                        end
                    end
                end
            end
        end
    end)
end

RunService.Heartbeat:Connect(function()
    checkAnims()
    checkM1Catch()
end)

-- SNIPPET 3 COMPLETE
-- SNIPPET 4: AUTO COUNTER + BLUE CHAMS ESP + ALL UTILITIES
local delayed = {["rbxassetid://10479335397"]=true, ["rbxassetid://13380255751"]=true, ["rbxassetid://134775406437626"]=true}
local normal = {}
for _, group in pairs(allIDs) do
    for i = 1, 4 do normal["rbxassetid://"..tostring(group[i])] = true end
    if group.special then normal["rbxassetid://"..tostring(group.special)] = true end
end
for id in pairs(skillIDs) do normal["rbxassetid://"..tostring(id)] = true end

local function fireCounter()
    if not Communicate then return end
    pcall(function()
        local prey = LocalPlayer.Backpack and LocalPlayer.Backpack:FindFirstChild("Prey's Peril")
        if prey then Communicate:FireServer({Tool=prey, Goal="Console Move"}) end
        local split = LocalPlayer.Backpack and LocalPlayer.Backpack:FindFirstChild("Split Second Counter")
        if split then Communicate:FireServer({Tool=split, Goal="Console Move"}) end
    end)
end

RunService.Heartbeat:Connect(function()
    if not counterActive or isBlocking() or not HRP or not Character then return end
    pcall(function()
        for _, model in pairs(Live:GetChildren()) do
            if model:IsA("Model") and model ~= Character then
                local hrp = model:FindFirstChild("HumanoidRootPart")
                local hum = model:FindFirstChildOfClass("Humanoid")
                if hrp and hum and hrp.Parent and HRP.Parent then
                    if (HRP.Position - hrp.Position).Magnitude <= counterRange then
                        local anim = hum:FindFirstChildOfClass("Animator")
                        if anim then
                            for _, track in pairs(anim:GetPlayingAnimationTracks()) do
                                local id = track.Animation.AnimationId
                                if normal[id] or delayed[id] then
                                    local key = tostring(model:GetDebugId())..tostring(id)
                                    if not lastFire[key] or os.clock()-lastFire[key] > 1.0 then
                                        lastFire[key] = os.clock()
                                        if delayed[id] then task.delay(0.05, fireCounter) else fireCounter() end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end)
end)

-- BLUE CHAMS ESP
local ESPFolder = Instance.new("Folder", workspace)
ESPFolder.Name = "CPS_CHAMS"
local espCache = {}

local function updateESP(plr)
    if not plr or not plr.Character or not ESPEnabled then return end
    if espCache[plr] and espCache[plr].chams and espCache[plr].chams.Parent then
        local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
        if hrp then espCache[plr].chams.Position = hrp.Position end
        return
    end

    local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local chams = Instance.new("Part")
    chams.Name = "Chams"
    chams.Shape = Enum.PartType.Ball
    chams.CanCollide = false
    chams.CanQuery = false
    chams.CanTouch = false
    chams.Anchored = true
    chams.TopSurface = Enum.SurfaceType.Smooth
    chams.BottomSurface = Enum.SurfaceType.Smooth
    chams.Color = Color3.fromRGB(0, 100, 255)
    chams.Material = Enum.Material.Neon
    chams.Size = Vector3.new(3, 3, 3)
    chams.Position = hrp.Position
    chams.Parent = ESPFolder
    
    espCache[plr] = {chams = chams}
end

local function removeESP(plr)
    if espCache[plr] then
        pcall(function() espCache[plr].chams:Destroy() end)
        espCache[plr] = nil
    end
end

local espAccum = 0
RunService.Heartbeat:Connect(function(dt)
    if not ESPEnabled then return end
    espAccum = espAccum + dt
    if espAccum < 0.5 then return end
    espAccum = 0

    pcall(function()
        for _, plr in pairs(Players:GetPlayers()) do
            if plr and plr ~= LocalPlayer and plr.Character and plr.Character.Parent == workspace then
                updateESP(plr)
            else
                removeESP(plr)
            end
        end
    end)
end)

Players.PlayerRemoving:Connect(function(plr) removeESP(plr) end)

-- UTILITIES TAB
Tabs.Utils:Toggle{Title="Enable ESP", Value=true, Callback=function(v) ESPEnabled=v; if not v then for p in pairs(espCache) do removeESP(p) end end end}
Tabs.Utils:Button{Title="Copy Discord", Callback=function() if setclipboard then pcall(function() setclipboard("https://discord.gg/cpshub") end) end; WindUI:Notify({Title="Copied!", Content="discord.gg/cpshub", Duration=2}) end}
Tabs.Utils:Button{Title="Copy YouTube", Callback=function() if setclipboard then pcall(function() setclipboard("https://youtube.com/@waspire") end) end; WindUI:Notify({Title="Copied!", Content="youtube.com/@waspire", Duration=2}) end}
Tabs.Utils:Button{Title="Refresh", Callback=function() pcall(function() if LocalPlayer.Character then LocalPlayer.Character:BreakJoints(); task.wait(0.1); LocalPlayer:LoadCharacter() end end) end}
Tabs.Utils:Slider{Title="Walk Speed", Value={Min=16, Max=100, Default=16}, Step=1, Callback=function(v) pcall(function() if Character and Character:FindFirstChildOfClass("Humanoid") then Character:FindFirstChildOfClass("Humanoid").WalkSpeed=v end end) end}
Tabs.Utils:Slider{Title="Jump Power", Value={Min=50, Max=200, Default=50}, Step=1, Callback=function(v) pcall(function() if Character and Character:FindFirstChildOfClass("Humanoid") then Character:FindFirstChildOfClass("Humanoid").JumpPower=v end end) end}

print("✅ CPS Network - All Systems Loaded!")
print("✅ Autoblock: Working")
print("✅ Auto Counter: Working")
print("✅ Camlock: Working")
print("✅ ESP: Working")
print("✅ All Systems Operational")

-- SNIPPET 4 COMPLETE - FULL SCRIPT READY
